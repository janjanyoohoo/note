# Java设计模式

## 概念

设计模式原则,其实是指程序员在编程时,应当遵守的原则. 也是各种设计模式的基础;

- 七大原则
  - 单一职责
  - 开放封闭
  - 里式替换
  - 依赖倒置
  - 接口隔离
  - 迪米特
  - 合成复用

```txt
编写软件过程中，程序员面临着来自耦合性，内聚性以及可维护性，可扩展性，重用性，灵活性等多方面的 挑战，设计模式是为了让程序(软件)，具有更好的
1) 代码重用性 (即：相同功能的代码，不用多次编写) 
2) 可读性 (即：编程规范性, 便于其他程序员的阅读和理解)
3) 可扩展性 (即：当需要增加新的功能时，非常的方便，称为可维护) 
4) 可靠性 (即：当我们增加新的功能后，对原来的功能没有影响) 
5) 使程序呈现高内聚，低耦合的特性 
```

### 单一职责

`一个类只应当只负责一项职责`

- 对一个类来说,一个类应当只负责一项职责;
  - 如果一个类具有两个功能A,B; 当A功能需要改变类时,可能导致功能2受到影响;所以应当将类的粒度分为A,B两个类

一个类只负责一种事情(粒度); 负责交通工具的类,是否应当区分负责骑车,自行车的类的职责;

当一个类的方法较少时,特殊情况下可以将类级别的单一职责下沉到方法级别实现单一职责;

#### 单一职责原则注意事项和细节 

1) 降低类的复杂度，一个类只负责一项职责。 

2) 提高类的可读性，可维护性 

3) 降低变更引起的风险 

4) 通常情况下，我们应当遵守单一职责原则，只有逻辑足够简单，才可以在代码级违反单一职责原则；只有类中
方法数量足够少，可以在方法级别保持单一职责原则

### 接口隔离

`客户端不应该依赖他不需要的接口,即一个类对另一个类的依赖应该建立在最下级的接口上`

将一个接口拆分为具体的多个接口,再定义一个子接口继承全部接口,类只需根据自己需要的方法依赖对应的接口即可;

![image-20210530223317868](https://jianjiandawang.oss-cn-shanghai.aliyuncs.com/Typora/20210530223317.png)

- 示例

此时,类AAA或类BBB通过接口A依赖了AA或BB,

但是AAA或BBB只需要接口A的一个方法, 而他们所依赖的实现类AA或BB则必须要重写全部方法

这种情况又被接口隔离原则,应当拆分为两个接口Aa/Ab ,而AAA/BBB依赖实现拆分后接口的实现类,则可以避免依赖A接口的全部方法;

拆分后的Aa&Ab 只包含了A的部分方法,此时可以定义第三个接口Ac ,此接口继承AaAb即可拥有原接口A的全部方法,又实现了接口隔离原则

```java
// 接口A
interface A{
    function1();
    function2();
}

//实现类AA 
class AA implement A{
    function1(){
        ...
    }
    function2(){
        ...
    }
}
//实现类BB
class BB implement A{
    function1(){
        ...
    }
    function2(){
        ...
    }
}
//类AAA
class AAA{
    fun(A a){
        a.function1();
    }
}
//类BBB
class AAA{
    fun(A a){
        a.function2();
    }
}
/*************************实现接口隔离原则************************************/
// 接口A1
interface A1{
    function();
}
//接口A2
interface A2{
    function();
}
//实现类A1impl
class A1impl implement A1{
     function(){
         ...
     }
}
//实现类A2impl
class A2impl implement A2{
         function(){
         ...
     }
}
//类C1
class C1{
    fun(A1 a){
        a.function();
    }
}
//类C2
class C2{
    fun(A2 a){
        a.function();
    }
}
```

### 依赖倒置

依赖倒置原则(Dependence Inversion Principle)是指：

- 1) 高层模块不应该依赖低层模块，二者都应该依赖其抽象 

- 2) 抽象不应该依赖细节，细节应该依赖抽象 

- 3) 依赖倒转(倒置)的中心思想是面向接口编程
- 4) 依赖倒转原则是基于这样的设计理念：相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建的架 构比以细节为基础的架构要稳定的多。在 java 中，抽象指的是接口或抽象类，细节就是具体的实现类
- 5) 使用接口或抽象类的目的是制定好规范，而不涉及任何具体的操作，把展现细节的任务交给他们的实现类去完
  成

依赖倒置的核心是面向接口编程,依赖抽象;

依赖关系的三种传递方式:

1. 构造方法传递(成员变量定义为接口)
2. Set方法传递(成员变量定义为接口)
3. 通过接口传递(方法参数接收接口)

```java
//接口
interface Ainterface{
    void function();
}
//通过接口传递
class Alass{
    public void fun(Ainterface ai){
        ai.function();
    }
}
//通过构造方法依赖
class Alass{
    public Alass(Ainterface ai){
        ai.function();
    }
}
//通过SET方法依赖
class Alass{
    private Ainterface ai;
    public void setAi(Ainterface ai){
        this.ai = ai;
    }
}
```

依赖倒置原则和注意事项

1. 低层模块尽量都要有抽象类和接口,或者两者都有,稳定性更好;
2. 变量的声明类型尽量是抽象类或接口,这样我们的变量引用和实际对象之间有一层缓冲层,有利于程序的扩展和优化;
3. 继承时,遵循里式替换原则;

### 里式替换原则

OO中的继承性的思考和说明

1) 继承包含这样一层含义：父类中凡是已经实现好的方法，实际上是在设定规范和契 约，虽然它不强制要求所有的子类必须遵循这些契约，但是如果子类对这些已经实 现的方法任意修改，就会对整个继承体系造成破坏。
2) 继承在给程序设计带来便利的同时，也带来了弊端。比如使用继承会给程序带来侵 入性，程序的可移植性降低，增加对象间的耦合性，如果一个类被其他的类所继承， 则当这个类需要修改时，必须考虑到所有的子类，并且父类修改后，所有涉及到子 类的功能都有可能产生故障
3) 问题提出：在编程中，如何正确的使用继承? => **里氏替换原则**

- 在任何使用父类的地方,能够透明的使用子类
- 遵循里氏替换原则，在子类中尽量不要重写父类的方法
- 继承实际上让两个类耦合性增强了，在适当的情况下，可 以通过聚合，组合，依赖来解决问题。
  - 组合/聚合->在A类中定义B类对象与所需要的方法,通过B对象调用方法

```java
// 原结构 A <- B 当B重写A中方法时不符合里式替换, 改用以下方式,通过定义一个共同的基类Base,然后使用聚合/组合来实现B中可以调用A的方法
//基类
class Base{
    
}

//A类
class A extent Base{
    void fun1(){
        
    }
}
//B类
class B extent Base{
    private A a = new A();
    void fun2(){
        
    }
    //组合
    void fun1(){
        a.func1();
    }
}
```

### 开闭原则

1) 开闭原则（Open Closed Principle）是编程中最基础、最重要的设计原则 

2) 一个软件实体如类，模块和函数应该对扩展开放(对提供方)，对修改关闭(对使用 方)。用抽象构建框架，用实现扩展细节。

3) 当软件需要变化时，尽量**通过扩展软件实体的行为来实现变化，而不是通过修改已 有的代码来实现变化。**

4) 编程中遵循其它原则，以及使用设计模式的目的就是遵循开闭原则。

